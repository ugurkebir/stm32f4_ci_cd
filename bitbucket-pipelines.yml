image: ubuntu:22.04

pipelines:
  default:
    - step:
        name: Build STM32F4
        runs-on:
          - self.hosted
          - linux.arm64
        script:
          - apt-get update
          - apt-get install -y --no-install-recommends build-essential cmake make ninja-build python3 python3-pip git ca-certificates
          - apt-get install -y --no-install-recommends gcc-arm-none-eabi binutils-arm-none-eabi gdb-multiarch
          - make -j"$(nproc)" || true
          - |
            if ls build/*.elf >/dev/null 2>&1; then
              arm-none-eabi-objcopy -O ihex build/*.elf build/firmware.hex || true
              arm-none-eabi-objcopy -O binary build/*.elf build/firmware.bin || true
            fi
        artifacts:
          - build/**/*.elf
          - build/**/*.hex
          - build/**/*.bin
    - step:
        name: Unit tests host
        runs-on:
          - self.hosted
          - linux.arm64
        script:
          - echo "No unit tests yet"
